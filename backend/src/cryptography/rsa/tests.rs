use super::*;
use crate::util::UintDisplay;
use num_bigint::BigUint;
use num_traits::Num;

#[test]
// really slow in dev/test compile mod, use release for this
fn test_key_generation() {
    generate_key(2048);
    generate_key(4096);
}

#[test]
fn test_encrypt() {
    let key = PrivateKey::new(
        BigUint::from_str_radix("cf610933ca3dd3de1c645d21f8dc23cb8a2f3e1b8be0998ed0b65bfc47bdaa380d2d64fb6f7275cdf4adb4ad5c4c6b5414bda0db31b8b57647a051d2a6073c6a53fb02f0aa83d282b1bcff2e6cebe0b1a6281ff3c8d2c30eec64112b15b1a91ec8c3a499d23176282d2a469c88fd16eadbafec22146617ba8f70ede1aa3c6ae0ec4de9478c428b586c1d5642e18ca1ae16b3987ad023c056a5652741f5de2266b4c242758bc84d55face6aea2897cfdd4b9c5b94773890ff5c78042b5152bef2887ed0613d12d0c6ad8316a19a204049f80f52439dd34220255d35a952097bfb733df09c3c48a3cc260aa545ff7eb930f015196c1c4112e1d8ed6cd4193a7e01", 16).unwrap(),
        BigUint::from_str_radix("2612aa9dd783826244d42845146b56270837a42f6a7ed1b2669f14443ce79558b512a07788fe7aa255498ee2450fc2a4ad2a235e1ac2ce8de898866d260e2e095761be287125c2803c2176b80f473ef95e87ff55c288ef46ce1f910757f4461860c38a74b322618efebbc43af8eb7e49a00bac4e957028eb176aa441c9ff4d9fa8db43bd0f050fd86346a23f13b7e0a57f5e25ca08bdd8e2d6d742baab6996b06a35c880b0ba422c25d1226bae28209e41c53958aa6d85e074e611472c8819b946767560a563a3fff1a0a998aaefcc81d06b9f5fa2120a7a527c2aa057502557e3544e1f0c849620301a96ddcc77d095be8bdbc967fdb3d3c73383a62d27d001", 16).unwrap(),
        BigUint::from_str_radix("10001", 16).unwrap(),
        BigUint::from_str_radix("d3cefa0664e6be20968d1b61a210a862c3d986a3d52be25ba652aa59ae36c7a5a41febec108e44674f346cdcb2cc15ff6f5d8ddeba19db13f47722b2d81257173d9decd20eba39963ea60a12168c67b4ec15513a6ffc4bb11d5d2d10748c7bbf9cd170dc9b125b160e33a22d4ff83084aa3aa0dfbd851e76a848c69bbd21f72d", 16).unwrap(),
        BigUint::from_str_radix("faa579a16f7bd36667f79a13d82ff74eba437debc70e4cf1cf89c60ec99b0df2112ee0458a5019d13946c0d800449a69624c8643f4d16d73b008eb66d16feea2c723b3687bdf33071f30e5369103b00989a5ec5eef8196d9fd4f12e25b184e5c557bc98cae1224864d0eb18e66e53c210eab9cdca14e6d3cff777b75f5aba6a5", 16).unwrap()
    );

    let m = BigUint::from_str_radix("f3fb70fb33e0e8bc017babad4909ea66b90f015391e8ec1e0785d1f99d6a20afe6927293301bbf8b1e052823f7b65352f01520d68814f6f605b608cb845c96364f70a4c3538fab0b616fd497bd10672c9592e3555c4f2f103b2de91e17e01d465a1828247acdeec1df8d476a6761052bca7040b2f58eb35e0d21ac8d69d73d2ae2194c70237e5f3e4512f9ec9405fd943d3e6b0a139824222e7e9719306782ca4906edd89981d7a172f7c89ce21f4a6049d514c74e8b622840590004213b2fe18fe6a97ca33caa144720a001966ed9013e00ee2ddd4f17edcaf5d1168dfeecb4a177d9a637b9fe97e2de0ce372a1a248708a8d6a7f7289b1328ab2ce49d0ca", 16).unwrap();

    assert_eq!(
        key.public().encrypt(m).hex(),
        "c00f306eb5cba47c4c974b2927ee51bc59a0c205e08af5ac2e26b27af75ee8f9e32997435e795813c08c96c2d029140b0e300ccc509849fda7f1c999719aaf544c8d1bbd6fcbebcd3bf2449e293af7354dbed7bfb88873278e0036965d667b67fc96df3359c85b387d66f2f3ab8f1e23538497c775c02fe2b692af04f77bcd035b1031d70c87a838cc368bf312b8e449b0abe71b5ee4238ae40a4b1edaa1c810a94762d1ffb5f66cbd820c76a76f6c010508f4a9c9b53a2813713bec379a11307c01b01572d0dd4a0fd501ab371a80d266a17b0aa4f9e1eeace04275d3cb476118cc8dd43cfe28ea1f1310830acb85f03620811ea7252a863dbafbe6dc64975c"
    );
}

#[test]
fn test_decrpyt() {
    let key = PrivateKey::new(
        BigUint::from_str_radix("d272a6aed0062383ec948ac97c8c2e2c395d2af72e4b4513c9033c736786ba2d694772766320b4465659d5015dbfdd806b7c0342cf0a35fdb88265910526e95d7303293178ea53b9c83ad55abdeeded1ea8d20d9d2786688d88dc3307864a8aa65c32220f1181c75e98f7b26e0879442ac11010dbdcfe4c893154ad60fcae7f7e67588eaf2ce2fdf307182b507b22fa480d447e4c31cb49b9d112fac609b12ca5a5de9d05a751313dfae6e86424be9a6b5060ffeb360c1ac4f00e7142beed7a939790d2dad5aa1bc00b420ea3e904e5c17f66846149f998efb7bb7fb7a2caf547b8fa8e60e1135780ae0bdce8f6f7fdeee46a7399fa7f116ebbbdfdba49dc7dd", 16).unwrap(),
        BigUint::from_str_radix("3a9a7ceb31610afc16dedad4acd384faa34fa62757a8b93c2e4b60d43b8d932ff735892a6e98c114338beb7b0363b4b0150887fae39f66d56277faeb96a561063fdf3c6a4055f33e2e1f0ba9328bdfdf2927c57e264d5383ad361dcd3fef69aa5ab9b21ee6120d6f195132f37ee3f1a218a6be82b00ecf855c2cc0e6e8eab9d6173d02e05c259e688cfdfc55b4ec1cc38be5b30627dac49e5877c9289498b1b8484495a6eb405394f334284a5eee3705baee9f462074b43be053109aca0ca03767d7f6b3eba2ead297fa8f0d433bde9fd12a10c83b413b29ce0a750fa4243070218f799f419aec706891b0d268c0fd5b2e6ca1c67b3205ee726b6a5e081523", 16).unwrap(),
        BigUint::from_str_radix("10001", 16).unwrap(),
        BigUint::from_str_radix("d5d6d7414fa93e96af54d90e795fe7e8189d0c2dcbcd6abaf32a1f6894d0333292017b2e6677ca291ea494923965dc12c0951befb0c2b5b0dfbdb33caee1b44bacef2118d72e78fdd2617ad80b70c7c86fe8b6a2989eed515c8999177b25117fb14aa40c0d8816a87870bead1fe6b30f39a02fda049d48fbbe0ac9ba80b87c07", 16).unwrap(),
        BigUint::from_str_radix("fbf0a3135f6608e5fe65dd1cef4cc99259ef496a905ce3105b2844eb72549cdfc806ea563efdd229bccccbfce93415dfc070d26eca21b9bf53ee75654a2149b919ca1596cfd9f5c4002a088651d96785f1f499bbbe65d3d8c145a988a3ad6949ab900c6ae3d7922171e66d3c7b5bb573e63347b0a878a37e21f115925a212bfb", 16).unwrap()
    );


    let c = BigUint::from_str_radix("e6ebf1f6a400406aea1764d94ddfe3e3214c2896769c498eba8218a52d098ad905d9c93c6e8a802db99a5e1075785fec77021fe14d7371cf0bf86f418872cbb3ee5107a5e9b038b2b1ad8046e0eb855d819896fc60032ba9eb00eaa02f356d6b7c9663daa46c18d6811f94f661b26da17041f08ec3c60fa40045ecc34a05056ce4b86fe2a2722a37f9f01d150d6d3f4f97a7d668219c93f370de048ed1c9efd92912e67c62ed43ff971745c4ce239101b5a0a846e5380bbe237948dfd671b4f7d4c90514ae4ae1ce5fb4f2182dfe075d8538f11e5f3c4d6b30acbab4baa13b6bbf8172959b128e5696cd4c50f34dfd329c2b229cb30fc722cf12d9c4e2f915", 16).unwrap();

    assert_eq!(
        key.decrypt(c).unwrap().hex(),
        "a987019a42bfa64625dfc2999332ca52c653b67448493211c25eb948f6ff6fb3b65649ca791dc845e5d7bfea1c9e682d4075c24747e0ce3335a83499eb7d17b2a46ea5e372a1e2d1ede9aba2c9a2ab56ad241004e3b3d453729885008954a171ebffc1624d99a1649049d8a9143e365b002462b0c95ba0b0ef62780444f0eccf0603a682094fd7f35e34e40987d49e68fde6a3b12d37c4944ee45913e6902fa972e36824ffee9f2ae68a612df049a31a7e4089fe8a5970c0b56a2553d520eb4b3c5a783f31cc0296657ddaafb810d9525bbad0c30d982ace7de2abbb7a24603f092f454a3eb3a2999e24114c74e11decf97aac686e8362752b0b2744cb4a9e54"
    );

}
